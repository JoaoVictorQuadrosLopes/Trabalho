<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Financeiro</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/style.css?v=1.0}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-4">
    <h1 class="text-center mb-4">Organiza√ß√£o Financeira</h1>
    <div class="text-end mb-3">
    <!-- Bot√£o Sair -->
<div class="text-end mb-3">
    <form th:action="@{/logout}" method="post">
        <button type="submit" class="btn btn-danger">üö™ Sair</button>
    </form>
</div>
    
    <button id="toggleTheme" class="btn btn-outline-secondary">üåô Dark Mode</button>
</div>
    

    <!-- Saldo -->
    <div class="card text-center mb-4 shadow">
        <div class="card-body">
            <h4 class="card-title">Saldo Atual</h4>
            <h2 th:text="${saldo}" class="fw-bold"></h2>
        </div>
    </div>

    <!-- Relat√≥rios -->
    <div class="card shadow mb-4">
        <div class="card-header">
            <h5 class="mb-0">Relat√≥rios</h5>
        </div>
        <div class="card-body">
            <form method="get" th:action="@{/relatorio/exportar}" class="row g-3">
                <div class="col-md-4">
                    <label for="inicio">Data In√≠cio</label>
                    <input type="date" id="inicio" name="inicio" class="form-control">
                </div>
                <div class="col-md-4">
                    <label for="fim">Data Fim</label>
                    <input type="date" id="fim" name="fim" class="form-control">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-success w-100">üì• Baixar Relat√≥rio</button>
                </div>
            </form>

            <div class="mt-3">
                <a th:href="@{/relatorio/periodo?tipo=semana}" class="btn btn-outline-primary">Semana Atual</a>
                <a th:href="@{/relatorio/periodo?tipo=mes}" class="btn btn-outline-primary">M√™s Atual</a>
                <a th:href="@{/relatorio/periodo?tipo=ano}" class="btn btn-outline-primary">Ano Atual</a>
            </div>
        </div>
    </div>
    

    <!-- A√ß√µes -->
    <div class="d-flex justify-content-between mb-3">
        <a th:href="@{/transacoes/nova}" class="btn btn-success">+ Nova Transa√ß√£o</a>
        <a th:href="@{/categorias/nova}" class="btn btn-primary">+ Nova Categoria</a>
    </div>

    <!-- Tabela de transa√ß√µes -->
    <div class="card shadow mb-4">
        <div class="card-header">
            <h5 class="mb-0">Transa√ß√µes</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Descri√ß√£o</th>
                    <th>Valor</th>
                    <th>Tipo</th>
                    <th>Categoria</th>
                    <th>Data</th>
                    <th>A√ß√µes</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="t : ${transacoes}">
                    <td th:text="${t.descricao}"></td>
                    <td th:text="${t.valor}"></td>
                    <td>
                        <span th:if="${t.tipo == 'RECEITA'}" class="badge bg-success">Receita</span>
                        <span th:if="${t.tipo == 'DESPESA'}" class="badge bg-danger">Despesa</span>
                    </td>
                    <td th:text="${t.categoria != null ? t.categoria.nome : 'Sem categoria'}"></td>
                    <td th:text="${#temporals.format(t.data, 'dd/MM/yyyy')}"></td>
                    <td>
                        <a th:href="@{'/transacoes/editar/' + ${t.id}}" class="btn btn-sm btn-warning">Editar</a>
                        <a th:href="@{'/transacoes/excluir/' + ${t.id}}" class="btn btn-sm btn-danger"
                           onclick="return confirm('Tem certeza que deseja excluir?')">Excluir</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Gr√°fico -->
    <div class="card shadow">
        <div class="card-header">
            <h5 class="mb-0">Resumo em Gr√°fico</h5>
        </div>
        <div class="card-body">
            <canvas id="graficoFinanceiro" width="400" height="200"></canvas>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    let receitas = [[${receitas}]];
    let despesas = [[${despesas}]];

    const ctx = document.getElementById('graficoFinanceiro').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Receitas', 'Despesas'],
            datasets: [{
                label: 'R$',
                data: [receitas, despesas],
                backgroundColor: ['#28a745', '#dc3545']
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'R$ ' + value;
                        }
                    }
                }
            }
        }
    });
    /*]]>*/
</script>
<script>
    const toggleBtn = document.getElementById("toggleTheme");
    const body = document.body;

    // Mant√©m prefer√™ncia do usu√°rio
    if (localStorage.getItem("theme") === "dark") {
        body.classList.add("dark-mode");
        toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
    }

    toggleBtn.addEventListener("click", () => {
        body.classList.toggle("dark-mode");

        if (body.classList.contains("dark-mode")) {
            localStorage.setItem("theme", "dark");
            toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
        } else {
            localStorage.setItem("theme", "light");
            toggleBtn.textContent = "üåô Dark Mode";
        }
    });
</script>

</body>
</html>
